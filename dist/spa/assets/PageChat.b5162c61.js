import{c as Q,h as B,m as F,d as U}from"./use-router-link.01604f00.js";import{u as L,a as N}from"./use-dark.1116cf1f.js";import{c as r,h as s,g as V,i as P,e as $,r as H,f as A,w as q,o as I,l as R,_ as O,m as j,q as G,t as M,u as p,v as w,z as E,A as K,y as J,D as W,R as X,S as Y,U as Z,x as y}from"./index.96129251.js";import{Q as ee}from"./QBtn.6a7f6267.js";import{a as te,Q as ae}from"./QForm.aaa24dbb.js";import{m as se,Q as ne}from"./mixin-other-user-details.088620a2.js";import{Q as oe}from"./QResizeObserver.1310bb85.js";import{Q as re}from"./QPage.0ba3aa5d.js";var le=Q({name:"QBanner",props:{...L,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(e,{slots:n}){const{proxy:{$q:u}}=V(),v=N(e,u),t=r(()=>"q-banner row items-center"+(e.dense===!0?" q-banner--dense":"")+(v.value===!0?" q-banner--dark q-dark":"")+(e.rounded===!0?" rounded-borders":"")),c=r(()=>`q-banner__actions row items-center justify-end col-${e.inlineActions===!0?"auto":"all"}`);return()=>{const o=[s("div",{class:"q-banner__avatar col-auto row items-center self-start"},B(n.avatar)),s("div",{class:"q-banner__content col text-body2"},B(n.default))],i=B(n.action);return i!==void 0&&o.push(s("div",{class:c.value},i)),s("div",{class:t.value+(e.inlineActions===!1&&i!==void 0?" q-banner--top-padding":""),role:"alert"},o)}}}),ie=Q({name:"QChatMessage",props:{sent:Boolean,label:String,bgColor:String,textColor:String,name:String,avatar:String,text:Array,stamp:String,size:String,labelHtml:Boolean,nameHtml:Boolean,textHtml:Boolean,stampHtml:Boolean},setup(e,{slots:n}){const u=r(()=>e.sent===!0?"sent":"received"),v=r(()=>`q-message-text-content q-message-text-content--${u.value}`+(e.textColor!==void 0?` text-${e.textColor}`:"")),t=r(()=>`q-message-text q-message-text--${u.value}`+(e.bgColor!==void 0?` text-${e.bgColor}`:"")),c=r(()=>"q-message-container row items-end no-wrap"+(e.sent===!0?" reverse":"")),o=r(()=>e.size!==void 0?`col-${e.size}`:""),i=r(()=>({msg:e.textHtml===!0?"innerHTML":"textContent",stamp:e.stampHtml===!0?"innerHTML":"textContent",name:e.nameHtml===!0?"innerHTML":"textContent",label:e.labelHtml===!0?"innerHTML":"textContent"}));function b(l){return n.stamp!==void 0?[l,s("div",{class:"q-message-stamp"},n.stamp())]:e.stamp?[l,s("div",{class:"q-message-stamp",[i.value.stamp]:e.stamp})]:[l]}function C(l,m){const h=m===!0?l.length>1?f=>f:f=>s("div",[f]):f=>s("div",{[i.value.msg]:f});return l.map((f,_)=>s("div",{key:_,class:t.value},[s("div",{class:v.value},b(h(f)))]))}return()=>{const l=[];n.avatar!==void 0?l.push(n.avatar()):e.avatar!==void 0&&l.push(s("img",{class:`q-message-avatar q-message-avatar--${u.value}`,src:e.avatar,"aria-hidden":"true"}));const m=[];n.name!==void 0?m.push(s("div",{class:`q-message-name q-message-name--${u.value}`},n.name())):e.name!==void 0&&m.push(s("div",{class:`q-message-name q-message-name--${u.value}`,[i.value.name]:e.name})),n.default!==void 0?m.push(C(F(n.default()),!0)):e.text!==void 0&&m.push(C(e.text)),l.push(s("div",{class:o.value},m));const h=[];return n.label!==void 0?h.push(s("div",{class:"q-message-label"},n.label())):e.label!==void 0&&h.push(s("div",{class:"q-message-label",[i.value.label]:e.label})),h.push(s("div",{class:c.value},l)),s("div",{class:`q-message q-message-${u.value}`},h)}}}),ue=Q({name:"QFooter",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(e,{slots:n,emit:u}){const{proxy:{$q:v}}=V(),t=P(R,$);if(t===$)return console.error("QFooter needs to be child of QLayout"),$;const c=H(parseInt(e.heightHint,10)),o=H(!0),i=H(A.value===!0||t.isContainer.value===!0?0:window.innerHeight),b=r(()=>e.reveal===!0||t.view.value.indexOf("F")>-1||v.platform.is.ios&&t.isContainer.value===!0),C=r(()=>t.isContainer.value===!0?t.containerHeight.value:i.value),l=r(()=>{if(e.modelValue!==!0)return 0;if(b.value===!0)return o.value===!0?c.value:0;const a=t.scroll.value.position+C.value+c.value-t.height.value;return a>0?a:0}),m=r(()=>e.modelValue!==!0||b.value===!0&&o.value!==!0),h=r(()=>e.modelValue===!0&&m.value===!0&&e.reveal===!0),f=r(()=>"q-footer q-layout__section--marginal "+(b.value===!0?"fixed":"absolute")+"-bottom"+(e.bordered===!0?" q-footer--bordered":"")+(m.value===!0?" q-footer--hidden":"")+(e.modelValue!==!0?" q-layout--prevent-focus"+(b.value!==!0?" hidden":""):"")),_=r(()=>{const a=t.rows.value.bottom,d={};return a[0]==="l"&&t.left.space===!0&&(d[v.lang.rtl===!0?"right":"left"]=`${t.left.size}px`),a[2]==="r"&&t.right.space===!0&&(d[v.lang.rtl===!0?"left":"right"]=`${t.right.size}px`),d});function g(a,d){t.update("footer",a,d)}function x(a,d){a.value!==d&&(a.value=d)}function k({height:a}){x(c,a),g("size",a)}function z(){if(e.reveal!==!0)return;const{direction:a,position:d,inflectionPoint:D}=t.scroll.value;x(o,a==="up"||d-D<100||t.height.value-C.value-d-c.value<300)}function T(a){h.value===!0&&x(o,!0),u("focusin",a)}q(()=>e.modelValue,a=>{g("space",a),x(o,!0),t.animate()}),q(l,a=>{g("offset",a)}),q(()=>e.reveal,a=>{a===!1&&x(o,e.modelValue)}),q(o,a=>{t.animate(),u("reveal",a)}),q([c,t.scroll,t.height],z),q(()=>v.screen.height,a=>{t.isContainer.value!==!0&&x(i,a)});const S={};return t.instances.footer=S,e.modelValue===!0&&g("size",c.value),g("space",e.modelValue),g("offset",l.value),I(()=>{t.instances.footer===S&&(t.instances.footer=void 0,g("size",0),g("offset",0),g("space",!1))}),()=>{const a=U(n.default,[s(oe,{debounce:0,onResize:k})]);return e.elevated===!0&&a.push(s("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),s("footer",{class:f.value,style:_.value,onFocusin:T},a)}}});const ce={mixins:[se],data(){return{newMessage:""}},computed:{...j("store1",["messages","userDetails"])},methods:{...G("store1",["firebaseGetMessages","firebaseStopGettingMessages","firebaseSendMessage"]),sendMessage(){this.firebaseSendMessage({message:{text:this.newMessage,from:"me"},otherUserId:this.$route.params.otherUserId}),this.newMessage=""},clearMessage(){this.newMessage="",this.$refs.newMessage.focus()},scrollToBottom(){console.log("scrollToBottom");let e=this.$refs.pageChat.$el;setTimeout(()=>{window.scrollTo(0,e.scrollHeight)},20)}},watch:{messages:{handler(e){this.scrollToBottom(),console.log("My store value for messaggi:",e)},deep:!0}},mounted(){this.showMessages=Object.keys(this.messages).length>0,this.firebaseGetMessages(this.$route.params.otherUserId)},unmounted(){this.firebaseStopGettingMessages()}},de={class:"q-pa-md column col justify-end"};function me(e,n,u,v,t,c){return M(),p(re,{ref:"pageChat",class:"page-chat flex column"},{default:w(()=>[e.otherUserDetails.online?J("",!0):(M(),p(le,{key:0,class:"bg-grey-4 text-center fixed-top q-banner"},{default:w(()=>[E(K(e.otherUserDetails.name)+" is offline. ",1)]),_:1})),W("div",de,[(M(!0),X(Z,null,Y(e.messages,(o,i)=>(M(),p(ie,{class:"messages-container",key:i,name:o.from=="me"?e.userDetails.name:e.otherUserDetails.name,text:[o.text],sent:o.from=="me","bg-color":o.from=="me"?"light-green":"white"},null,8,["name","text","sent","bg-color"]))),128))]),y(ue,{elevated:""},{default:w(()=>[y(ne,null,{default:w(()=>[y(te,{class:"full-width"},{default:w(()=>[y(ae,{ref:"newMessage",modelValue:t.newMessage,"onUpdate:modelValue":n[0]||(n[0]=o=>t.newMessage=o),"bg-color":"white",outlined:"",rounded:"",label:"Message",dense:""},{after:w(()=>[y(ee,{onClick:c.sendMessage,round:"",dense:"",flat:"",type:"submit",color:"white",icon:"send"},null,8,["onClick"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},512)}var Ce=O(ce,[["render",me]]);export{Ce as default};
